.PHONY: test-low test-mid test-high test-low-light test-mid-light test-high-light help
.PHONY: test-go test-go-light

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
C ?= 50
D ?= 30
URL_LOW = http://localhost:8083/2_php_fpm/test.php
URL_MID = http://localhost:8084/2_php_fpm/test.php
URL_HIGH = http://localhost:8085/2_php_fpm/test.php
URL_LOW_LIGHT = http://localhost:8083/2_php_fpm/test-light.php
URL_MID_LIGHT = http://localhost:8084/2_php_fpm/test-light.php
URL_HIGH_LIGHT = http://localhost:8085/2_php_fpm/test-light.php

# Go —Å–µ—Ä–≤–∏—Å URLs (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Ä—Ç 8090)
GO_PORT ?= 8090
URL_GO = http://localhost:$(GO_PORT)/test
URL_GO_LIGHT = http://localhost:$(GO_PORT)/test-light

# =========================================
# –ü–æ–º–æ—â—å
# =========================================
help:
	@echo "======================================="
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
	@echo "======================================="
	@echo ""
	@echo "–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make test-all          - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Low, Mid, High)"
	@echo "  make test-low          - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Low —Å–µ—Ä–≤–∏—Å–∞ (–ø–æ—Ä—Ç 8083)"
	@echo "  make test-mid          - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Mid —Å–µ—Ä–≤–∏—Å–∞ (–ø–æ—Ä—Ç 8084)"
	@echo "  make test-high         - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ High —Å–µ—Ä–≤–∏—Å–∞ (–ø–æ—Ä—Ç 8085)"
	@echo ""
	@echo "–õ–µ–≥–∫–∏–µ —Ç–µ—Å—Ç—ã (test-light.php):"
	@echo "  make test-low-light    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Low —Å–µ—Ä–≤–∏—Å–∞ —Å –ª–µ–≥–∫–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º"
	@echo "  make test-mid-light    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Mid —Å–µ—Ä–≤–∏—Å–∞ —Å –ª–µ–≥–∫–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º"
	@echo "  make test-high-light   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ High —Å–µ—Ä–≤–∏—Å–∞ —Å –ª–µ–≥–∫–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º"
	@echo ""
	@echo "–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:"
	@echo "  make test-mid C=150 D=45"
	@echo "  make test-high C=300 D=120"
	@echo ""
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:"
	@echo "  C - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100)"
	@echo "  D - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30)"
	@echo ""
	@echo "Go —Å–µ—Ä–≤–∏—Å:"
	@echo "  make test-go          - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Go —Å–µ—Ä–≤–∏—Å–∞ (–ø–æ—Ä—Ç $(GO_PORT))"
	@echo "  make test-go-light    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Go —Å–µ—Ä–≤–∏—Å–∞ —Å –ª–µ–≥–∫–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º"
	@echo "======================================="

# =========================================
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Low —Å–µ—Ä–≤–∏—Å–∞
# =========================================
test-low:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Low —Å–µ—Ä–≤–∏—Å–∞"
	@echo "–ü–æ—Ä—Ç: 8083"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_LOW)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_LOW) --renderStatusCodes

# =========================================
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Mid —Å–µ—Ä–≤–∏—Å–∞
# =========================================
test-mid:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Mid —Å–µ—Ä–≤–∏—Å–∞"
	@echo "–ü–æ—Ä—Ç: 8084"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_MID)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_MID) --renderStatusCodes

# =========================================
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ High —Å–µ—Ä–≤–∏—Å–∞
# =========================================
test-high:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ High —Å–µ—Ä–≤–∏—Å–∞"
	@echo "–ü–æ—Ä—Ç: 8085"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_HIGH)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_HIGH) --renderStatusCodes

# =========================================
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ª–µ–≥–∫–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º
# =========================================
test-low-light:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Low —Å–µ—Ä–≤–∏—Å–∞ (–ª–µ–≥–∫–∏–π —Å–∫—Ä–∏–ø—Ç)"
	@echo "–ü–æ—Ä—Ç: 8083"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_LOW_LIGHT)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_LOW_LIGHT) --renderStatusCodes

test-mid-light:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Mid —Å–µ—Ä–≤–∏—Å–∞ (–ª–µ–≥–∫–∏–π —Å–∫—Ä–∏–ø—Ç)"
	@echo "–ü–æ—Ä—Ç: 8084"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_MID_LIGHT)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_MID_LIGHT) --renderStatusCodes

test-high-light:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ High —Å–µ—Ä–≤–∏—Å–∞ (–ª–µ–≥–∫–∏–π —Å–∫—Ä–∏–ø—Ç)"
	@echo "–ü–æ—Ä—Ç: 8085"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_HIGH_LIGHT)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_HIGH_LIGHT) --renderStatusCodes

# =========================================
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Go —Å–µ—Ä–≤–∏—Å–∞
# =========================================
test-go:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Go —Å–µ—Ä–≤–∏—Å–∞"
	@echo "–ü–æ—Ä—Ç: $(GO_PORT)"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_GO)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_GO) --renderStatusCodes

test-go-light:
	@echo "======================================="
	@echo "üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Go —Å–µ—Ä–≤–∏—Å–∞ (–ª–µ–≥–∫–∏–π —Å–∫—Ä–∏–ø—Ç)"
	@echo "–ü–æ—Ä—Ç: $(GO_PORT)"
	@echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: $(C) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, $(D) —Å–µ–∫—É–Ω–¥"
	@echo "URL: $(URL_GO_LIGHT)"
	@echo "======================================="
	@npx autocannon -c $(C) -d $(D) $(URL_GO_LIGHT) --renderStatusCodes
